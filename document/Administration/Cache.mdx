# Cache

The RODE platform uses a [Redis](https://redis.io/) cache. The cache consists of a redis cluster with a single master and 2 slave replication. The master assignment can be accessed via the high availability Redis sentinel cluster.

{/* ![Redis Cluster Infrastructure](https://rode.forske.org/diagrams/cache/infrastructure.drawio.svg) */}

## Pre-Caching of Routine Values

## Request Caching

## Web API for Data Manipulation

## Content

### System Values

| Key                         | Data Type | Description                                                                                                                                                                                                | Example                                                                                                                                                                                                                                                                                                                                                                                             |
| :-------------------------- | :-------: | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| entity.definition           |   hash    | The entity definitions for how requests are targeted to the appropriate data services                                                                                                                      | `["domain": "rode", "service": "platform-svc", "database": "data_request", "table": "data_request", "params": [], "authorisation": true, "distribute": false, "collection": [ "project" ], "item": [ "class", "cohort", "project" ], "subresources": [ "class": [ "table":  data_request_class" ], "cohort": [ "table": "data_request_cohort" ], "project": [ "table": "data_request_project" ] ]]` |
| map.[data source]           |   hash    | The source field to target mapping for the particular source data. The map consists of `[entity].[subresource].[field]`, `[domain].[optional entity search]`, `[identifier flag]` as pipe separated values | `[ "facility_health_service": "person.affiliation.id_organisation\|id_organisation.name\|False", ]`                                                                                                                                                                                                                                                                                                 |
| map.[entity].[type]         |   hash    | The entity presented as a uuid to label mapping of the particular type                                                                                                                                     | `[ "uuid4": "Entity Label" ]`                                                                                                                                                                                                                                                                                                                                                                       |
| transform.[domain].[system] |   hash    | The domain transform values to map from the source domain to the target RODE domain values                                                                                                                 | `[ "Source Value": "RODE Value" ]`                                                                                                                                                                                                                                                                                                                                                                  |
| status.schedule             |   hash    | The system values monitoring the active scheduled jobs of the RODE system                                                                                                                                  | `[ [task name]: [ "last_run": [utc datetime] ]]`                                                                                                                                                                                                                                                                                                                                                    |
| status.request              |   hash    |                                                                                                                                                                                                            | `[ [request id]: "[microservice].[status]" ]`                                                                                                                                                                                                                                                                                                                                                       |
| status.subscription         |   hash    | The system values monitoring the active subscriptions of the RODE websockets                                                                                                                               | `[ "channel.[entity].[selectors]": [ subscribers: [count], last_run: [utc datetime] ] ]`                                                                                                                                                                                                                                                                                                            |

### End User Values

| Key                                 | Data Type | Description                                                                                                                                                                           | Example                                                               |
| :---------------------------------- | :-------: | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | :-------------------------------------------------------------------- |
| domain.[name]                       |   hash    | The domain map for label to value records and value to label records of the named domain                                                                                              | `[ "01": "Value 1", "Value 1": "01" ]`                                |
| domain.[name].options               |   hash    | The domain value to label map for the use of select elements in the user interface                                                                                                    | `[ "01": "Value 1" ]`                                                 |
| search.[entity]                     |   hash    | The search map for entity search values                                                                                                                                               | `[ "User Name": "uuid4", "User ID": "uuid4", "User Email": "uuid4" ]` |
| entity.[entity]                     |   hash    | The full entity definition for pre-cached values. These values should be filtered before transmitting to end user                                                                     | `[ "uuid4": [entity definition], "uuid4": [entity definition] ]`      |
| channel.[entity].[selectors]        |  pub/sub  | The push pipeline for the existing data subscriptions. When no connections exist for the channel the channel is purged                                                                |                                                                       |
| channel.[entity].[selectors].values |   hash    | The existing data for the named pub/sub channel. This data is to be updated on the database update polling and should be delivered to the new subscriber to the channel on connection | `[ "uuid4": [entity definition] ]`                                    |
| query.[name]                        |   hash    | The data representing the values for the scheduled queries                                                                                                                            | `[ [utc datetime]: [ [query results] ] ]`                             |
